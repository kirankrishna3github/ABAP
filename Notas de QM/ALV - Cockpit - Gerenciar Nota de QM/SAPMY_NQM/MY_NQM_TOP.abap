*&---------------------------------------------------------------------**& Include MY_NQM_TOP*&---------------------------------------------------------------------*PROGRAM sapmy_nqm.TYPE-POOLS: icon.TABLES: ynqm_1000, " Nota de QM : Gerenciamento        ynqm_1001, " Nota de QM : Visualizar Ação Imediata        ynqm_1002, " Nota de QM : Gerenciamento - Tela 1002        lfa1     , " Mestre de fornecedores (parte geral)        bapiaddr3, " Estrutura de referência BAPI p/endereços (pessoa de contato)        qpct     . " Textos codes*----------------------------------------------------------------------** Estruturas                                                           **----------------------------------------------------------------------*TYPES:  BEGIN OF ty_local               ,   codegruppe TYPE qpct-codegruppe, " Grupo de codes   code       TYPE qpct-code      , " Código   kurztext   TYPE qpct-kurztext  , " Nome do Local do defeito  END OF ty_local                 ,  BEGIN OF ty_lote                ,   matnr TYPE mcha-matnr          , " Nº do material   werks TYPE mcha-werks          , " Centro   charg TYPE mcha-charg          , " Número do lote  END OF ty_lote                  ,  BEGIN OF ty_status              ,   objnr TYPE jest-objnr          , " Nº objeto   stat  TYPE jest-stat           , " Status individual de um objeto   inact TYPE jest-inact          , " Código: status inativo  END OF ty_status                ,  BEGIN OF ty_status_selec        ,   istat TYPE tj02-istat          , " Status do sistema   desc  TYPE c LENGTH 10         , " Descrição  END OF ty_status_selec          ,  BEGIN OF ty_notas_qm            ,    qmnum  TYPE qmel-qmnum        , " Nº da nota    qmtxt  TYPE qmel-qmtxt        , " Texto breve    erdat  TYPE qmel-erdat        , " Data de criação do registro    matnr  TYPE qmel-matnr        , " Nº do material    mawerk TYPE qmel-mawerk       , " Centro para material    ernam  TYPE qmel-ernam        , " Nome do autor da nota    objnr  TYPE qmel-objnr        , " Nº objeto para administração de status    charg  TYPE qmel-charg        , " Número do lote    stat   TYPE jest-stat         , " Status individual de um objeto    inact  TYPE jest-inact        , " Código: status inativo    lifnum TYPE qmel-lifnum       , " Nº conta do fornecedor    name1  TYPE lfa1-name1        , " Nome do Fornecedor    otgrp  TYPE qmfe-otgrp        , " Grupo de codes - partes de objetos    oteil  TYPE qmfe-oteil        , " Parte do objeto    fegrp  TYPE qmfe-fegrp        , " Grupo de códigos - problemas    fecod  TYPE qmfe-fecod        , " Código do problema ou do dano  END OF ty_notas_qm              ,  BEGIN OF ty_acao_imediata       ,    mnkat    TYPE qmsm-mnkat      , " Tipo de catálogo - medidas    mngrp    TYPE qmsm-mngrp      , " Grupo de codes - medidas    mncod    TYPE qmsm-mncod      , " Código de medidas    kurztext TYPE qpct-kurztext   , " Descrição da Ação Imediata    peter    TYPE qmsm-peter      , " Data planejada para conclusão    objnr    TYPE qmsm-objnr      , " Nº objeto para administração de status    parnr    TYPE qmsm-parnr      , " Responsável pela medida (nº parceiro)    stat     TYPE jest-stat       , " Status individual de um objeto    txt30    TYPE tj02t-txt30     , " Status individual de um objeto (forma breve)  END OF ty_acao_imediata         ,  BEGIN OF ty_sub_contratacao     ,    mblnr    TYPE mseg-mblnr      , " Nº documento de material    zeile    TYPE mseg-zeile      , " Item no documento do material    bwart    TYPE mseg-bwart      , " Tipo de movimento (administração de estoques)    werks    TYPE mseg-werks      , " Centro    charg    TYPE mseg-charg      , " Número do lote    lifnr    TYPE mseg-lifnr      , " Nº conta do fornecedor    aufnr    TYPE mseg-aufnr      , " Nº ordem    bstmg    TYPE mseg-bstmg      , " Qtd.entrada em unidade de medida de pedido  END OF ty_sub_contratacao       .*----------------------------------------------------------------------** Tabelas internas                                                     **----------------------------------------------------------------------*DATA:  t_local           TYPE STANDARD TABLE OF ty_local          ,  t_problema        TYPE STANDARD TABLE OF ty_local          ,  t_lote            TYPE STANDARD TABLE OF ty_lote           ,  t_status          TYPE STANDARD TABLE OF ty_status         ,  t_status_selec    TYPE STANDARD TABLE OF ty_status_selec   ,  t_notas_qm        TYPE STANDARD TABLE OF ty_notas_qm       ,  t_acao_imediata   TYPE STANDARD TABLE OF ty_acao_imediata  ,  t_alv_nqm         TYPE STANDARD TABLE OF yalv_nqm_gerenc   ,  t_alv_acao_im     TYPE STANDARD TABLE OF yalv_nqm_acoes_im ,  t_alv_docnum      TYPE STANDARD TABLE OF yalv_nqm_docnum   ,  t_local_selec     TYPE STANDARD TABLE OF ddshretval        ,  t_lote_selec      TYPE STANDARD TABLE OF ddshretval        ,  t_sub_contratacao TYPE STANDARD TABLE OF ty_sub_contratacao,  t_return          TYPE STANDARD TABLE OF bapiret2          .DATA:  t_bdc TYPE STANDARD TABLE OF bdcdata    WITH HEADER LINE,  t_msg TYPE STANDARD TABLE OF bdcmsgcoll WITH HEADER LINE.DATA:  v_mode TYPE c VALUE 'E'.DATA:  t_fieldcat TYPE lvc_t_fcat,  w_fieldcat TYPE lvc_s_fcat,  w_detalhes LIKE bapiaddr3 .*----------------------------------------------------------------------** Ranges                                                               **----------------------------------------------------------------------*DATA:  r_data    TYPE RANGE OF sy-datum  ,  r_autor   TYPE RANGE OF sy-uname  ,  r_fornec  TYPE RANGE OF lfa1-lifnr,  r_status  TYPE RANGE OF tj02-istat,  r_nota_qm TYPE RANGE OF qmel-qmnum,  r_charg   TYPE RANGE OF mseg-charg,  r_matnr   TYPE RANGE OF mseg-matnr,  r_werks   TYPE RANGE OF mseg-werks.*----------------------------------------------------------------------** Work Areas                                                           **----------------------------------------------------------------------*DATA:  w_local           LIKE LINE OF t_local          ,  w_problema        LIKE LINE OF t_problema       ,  w_lote            LIKE LINE OF t_lote           ,  w_status          LIKE LINE OF t_status         ,  w_status_selec    LIKE LINE OF t_status_selec   ,  w_notas_qm        LIKE LINE OF t_notas_qm       ,  w_acao_imediata   LIKE LINE OF t_acao_imediata  ,  w_alv_nqm         LIKE LINE OF t_alv_nqm        ,  w_alv_acao_im     LIKE LINE OF t_alv_acao_im    ,  w_alv_docnum      LIKE LINE OF t_alv_docnum     ,  w_data            LIKE LINE OF r_data           ,  w_autor           LIKE LINE OF r_autor          ,  w_fornec          LIKE LINE OF r_fornec         ,  w_r_status        LIKE LINE OF r_status         ,  w_nota_qm         LIKE LINE OF r_nota_qm        ,  w_charg           LIKE LINE OF r_charg          ,  w_matnr           LIKE LINE OF r_matnr          ,  w_werks           LIKE LINE OF r_werks          ,  w_local_selec     LIKE LINE OF t_local_selec    ,  w_sub_contratacao LIKE LINE OF t_sub_contratacao.*----------------------------------------------------------------------** Variáveis                                                            **----------------------------------------------------------------------*DATA:  ok_code TYPE sy-ucomm.*----------------------------------------------------------------------** Objetos                                                              **----------------------------------------------------------------------*DATA:  obj_cont_notas_qm  TYPE REF TO cl_gui_custom_container,  obj_cont_acao_im   TYPE REF TO cl_gui_custom_container,  obj_cont_docto     TYPE REF TO cl_gui_custom_container,  obj_alv_grid_nqm   TYPE REF TO cl_gui_alv_grid        ,  obj_alv_grid_acao  TYPE REF TO cl_gui_alv_grid        ,  obj_alv_grid_docto TYPE REF TO cl_gui_alv_grid        .*----------------------------------------------------------------------** Constantes                                                           **----------------------------------------------------------------------*CONSTANTS:  c_cont_alv_notas_qm TYPE scrfname        VALUE 'CONT_ALV'         ,  c_cont_alv_acoes_im TYPE scrfname        VALUE 'CONT_ACAO_IM'     ,  c_cont_alv_docnum   TYPE scrfname        VALUE 'CONT_DOCNUM'      ,  c_tab_alv_notas_qm  TYPE ddobjname       VALUE 'YALV_NQM_GERENC'  ,  c_tab_alv_acoes_im  TYPE ddobjname       VALUE 'YALV_NQM_ACOES_IM',  c_tab_alv_doctos    TYPE ddobjname       VALUE 'YALV_NQM_DOCNUM'  ,  c_pt_br             TYPE t002-laiso      VALUE 'PT'               ,  c_msg_aberta        TYPE tj02-istat      VALUE 'I0068'            ,  c_msg_diferida      TYPE tj02-istat      VALUE 'I0069'            ,  c_msg_processamento TYPE tj02-istat      VALUE 'I0070'            ,  c_msg_encerrada     TYPE tj02-istat      VALUE 'I0072'            ,  c_marc_eliminacao   TYPE tj02-istat      VALUE 'I0076'            ,  c_xk03              TYPE tstc-tcode      VALUE 'XK03'             ,  c_msc3n             TYPE tstc-tcode      VALUE 'MSC3N'            ,  c_mm03              TYPE tstc-tcode      VALUE 'MM03'             ,  c_qm01              TYPE tstc-tcode      VALUE 'QM01'             ,  c_qm02              TYPE tstc-tcode      VALUE 'QM02'             ,  c_qm03              TYPE tstc-tcode      VALUE 'QM03'             ,  c_qm12              TYPE tstc-tcode      VALUE 'QM12'             ,  c_nota_qm           TYPE tq80-qmart      VALUE 'Z1'               ,  c_hotspot_nqm       TYPE lvc_s_col       VALUE 'NQM'              ,  c_hotspot_matnr     TYPE lvc_s_col       VALUE 'MATNR'            ,  c_hotspot_lote      TYPE lvc_s_col       VALUE 'CHARG'            ,  c_btn_criar_nqm     TYPE lvc_s_col       VALUE 'CR_NQM'           ,  c_hotspot_doc_mat   TYPE lvc_s_col       VALUE 'MBLNR'            ,  c_hotspot_fornec    TYPE lvc_s_col       VALUE 'LIFNUM'           ,  c_entr_mercadoria   TYPE t156-bwart      VALUE '101'              ,  c_btn_alterar_nc    TYPE lvc_s_col       VALUE 'ALT_NC'           ,  c_btn_acao_imediata TYPE lvc_s_col       VALUE 'ACAO_IMED'        ,  c_btn_aval_forn     TYPE lvc_s_col       VALUE 'AVAL_FORN'        ,  c_icone_editar      TYPE c LENGTH 04     VALUE '@0Z@'             ,  c_icone_criar       TYPE c LENGTH 04     VALUE '@0Y@'             ,  c_icone_visualizar  TYPE c LENGTH 04     VALUE '@10@'             ,  c_icone_aval_forn   TYPE c LENGTH 04     VALUE '@M0@'             ,  c_icone_sem_acao    TYPE c LENGTH 04     VALUE '@SR@'             ,  c_tp_defeito        TYPE c LENGTH 04     VALUE '%Z1%'             ,  c_desabilitar_campo TYPE c LENGTH 01     VALUE '0'                ,  c_habilitar_campo   TYPE c LENGTH 01     VALUE '1'                ,  c_chk_endereco_xk03 TYPE c LENGTH 08     VALUE '/110'             ,  c_local_defeito     TYPE tq15-katalogart VALUE 'E'                , " Localizações do defeito  c_tipo_defeito      TYPE tq15-katalogart VALUE '9'                . " Tipos de defeitos